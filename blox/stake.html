<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="96x96" href="/res/favi.png">
    <title>$BLOX Airdrop Staking</title>
    <meta property="og:title" content="$BLOX Airdrop Staking">
    <meta property="og:image" content="https://staking2.brixsociety.io/res/favi.png">
    <meta property="og:description" content="Stake your Brix Society Tokens.">
    <meta property="og:type" content="website">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TKRGTCTL23"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-TKRGTCTL23');
    </script>
</head>
<body>
    <div class="container">
        <div class="modal fade" id="login" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loginLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="loginLabel">Select wallet</h1>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="row">
                                <div id="login_msg" class="alert alert-danger visually-hidden mb-3" role="alert"></div>
                            </div>
                            <div class="row mb-3">
                                <button class="btn" style="color:white;background-color:rgb(133, 73, 182)" onclick="login('cloud');"><img src="/res/mycloudwallet.svg" class="float-start" height="24">Cloud Wallet</button>
                            </div>
                            <div class="row mb-3">
                                <button class="btn" style="color:white;background-color:rgb(54, 80, 162)" onclick="login('anchor');"><img src="/res/anchor.svg" class="float-start" height="24">Anchor</button>
                            </div>
                            <div class="row mb-3">
                                <button class="btn" style="color:white;background-color:rgb(252, 78, 36)" onclick="login('scatter');"><img src="/res/wombat.svg" class="float-start" height="24">Wombat</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="stake" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5">Add stake</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div id="stake-loading" class="d-flex justify-content-center mb-3">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                            <div class="visually-hidden" id="stake-input">
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <label for="stake-amnt" class="form-label">Amount to stake</label>
                                        <div class="input-group">
                                            <input id="stake-amnt" type="number" class="form-control"></input>
                                        </div>
                                        <label for="stake-amnt" class="form-label"><i class="bi bi-wallet2"></i> <a href="#" id="balance" class="text-decoration-none text-body-secondary" onclick="event.preventDefault();fill_max('balance')"></a></label>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <button class="btn btn-success" onclick="stake()">Stake</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="unstake" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5">Remove stake</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div id="unstake-loading" class="d-flex justify-content-center mb-3">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                            <div class="visually-hidden" id="unstake-input">
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <label for="unstake-amnt" class="form-label">Amount to unstake</label>
                                        <div class="input-group">
                                            <input type="number" id="unstake-amnt" class="form-control"></input>
                                        </div>
                                        <label for="unstake-amnt" class="form-label"><i class="bi bi-wallet2"></i> <a href="#" id="staked" class="text-decoration-none text-body-secondary" onclick="event.preventDefault();fill_max('staked')"></a></label>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <button class="btn btn-danger" onclick="unstake()">Unstake</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="./index.html" class="navbar-brand me-auto text-light text-wrap text-decoration-none">
                <h2 style="font-family:'Press Start 2P'">$BLOX AIRDROP STAKING</h2>
                <p>Stake your Brix Society Tokens.</p>
            </a>
            <ul class="nav nav-pills">
                <li class="nav-item"><a href="./index.html" class="nav-link" aria-current="page">BLOX Airdrop</a></li>
                <li class="nav-item" id="loginbtn"><a href="javascript:void(0)" class="nav-link active" aria-current="page" data-bs-toggle="modal" data-bs-target="#login">Login</a></li>
                <li class="nav-item dropdown visually-hidden" id="wallet">
                    <a class="nav-link dropdown-toggle text-light-emphasis" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">wallet</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="logout()">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </header>
        <main>
            <div class="row mb-3">
                <div id="err_msg" class="alert alert-danger visually-hidden" role="alert"></div>
                <div id="pass_msg" class="alert alert-success visually-hidden" role="alert"></div>
                <div id="no_login" class="alert alert-warning text-center" role="alert">Please login first</div>
            </div>
            <div class="row">
                <div id="loading" class="d-flex justify-content-center mb-3 visually-hidden">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div id="content"></div>
        </main>
        <footer class="mt-3">
            <div class="row justify-content-center border-top border-light">
                <p class="text-center my-3">Made by ryucrypt: wwiem.wam</p>
            </div>
        </footer>
    </div>
<script id="tmplt_pool" type="x-tmpl-mustache">
    <div class="card mb-3">
        <div class="card-header">
            <div class="row">
                <div class="col-12 col-lg-2 align-self-center text-center text-lg-start mb-2 mb-lg-0">
                    <h3 class="text-light">{{symbol}}</h3>
                    <h6>{{contract}}</h6>
                </div>
                <div class="col-6 col-lg-3 align-self-center">
                    <h6>Total Staked</h6>
                    <h4 class="text-light">{{total_staked}}</h4>
                </div>
                <div class="col-6 col-lg-3 align-self-center">
                    <h6>Your Stake</h6>
                    <h4 class="text-light">{{staked}}</h4>
                </div>
                <div class="col-6 col-lg-2 align-self-center">
                    <h6>Your Pool Share</h6>
                    <h4 class="text-light">{{stakedpct}}%</h4>
                </div>
                <div class="col-6 col-lg-2 align-self-center text-start text-lg-end ">
                    {{#toclaim}}{{/toclaim}}
                    <button type="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#pool-{{pool}}">Details</button>
                </div>
            </div>
        </div>
        <div class="card-body accordion-collapse collapse" id="pool-{{pool}}">
            <div class="row">
                <div class="col-12 col-lg-4 text-light">
                    <h6>Unstaking: <span id="unstaked-{{pool}}">{{unstaked}}</span></h6>
                    <h6>Claimable: <span id="claim-{{pool}}">{{claim}}</span></h6>
                    <h6>Wait time: <span id="wait-{{pool}}">N/A</span></h6>
                    {{#reduced}}{{/reduced}}
                </div>
                <div class="col-12 col-lg-8 align-self-center text-end">
                    <div class="row">
                        <div class="col-12 col-md-6 mb-2 mb-lg-0">
                            <button type="button" id="btn-open-{{pool}}" class="btn btn-primary" title="Open balance" onclick="open_bal({{pool}})">Open</i></button>
                            <button type="button" id="btn-close-{{pool}}" class="btn btn-primary" title="Close balance" onclick="close_bal({{pool}})">Close</i></button>
                        </div>
                        <div class="col-12 col-md-6">
                            <button type="button" id="btn-stake-{{pool}}" class="btn btn-success" title="Add stake" data-bs-toggle="modal" data-bs-target="#stake" onclick="load_stake({{pool}})">Stake</button>
                            <button type="button" id="btn-unstake-{{pool}}" class="btn btn-danger" title="Remove stake" data-bs-toggle="modal" data-bs-target="#unstake" onclick="load_unstake({{pool}})">Unstake</button>
                            <button type="button" id="btn-claim-{{pool}}" class="btn btn-warning" title="Claim stake" onclick="claim({{pool}})">Claim</i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.1.0/mustache.min.js" integrity="sha512-HYiNpwSxYuji84SQbCU5m9kHEsRqwWypXgJMBtbRSumlx1iBB6QaxgEBZHSHEGM+fKyCX/3Kb5V5jeVXm0OglQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/anchor-link@3"></script>
<script src="https://unpkg.com/anchor-link-browser-transport@3"></script>
<script src="/js/waxjs.js"></script>
<script src="/js/scatterjs-core-min.js"></script>
<script src="/js/scatterjs-plugin-eosjs2.min.js"></script>
<script src="/js/externals.min.js"></script>
<script src="/js/eosjs-api.min.js"></script>
<script src="/js/eosjs-jsonrpc.min.js"></script>
<script src="/js/wallets.js"></script>
<script>
const EXPLORER = "https://waxblock.io/transaction/";
const CONTRACT = "stake.brix";
const CONFIG = {
    "code": CONTRACT,
    "scope": CONTRACT,
    "table": "configs",
    "lower_bound": "",
    "upper_bound": "",
    "index_position": 1,
    "limit": 1000,
    "reverse": false,
    "json": true,
    "show_payer": false
};
var STAKES = {
    "code": CONTRACT,
    "scope": "",
    "table": "stakes",
    "lower_bound": "",
    "upper_bound": "",
    "limit": 1000,
    "reverse": false,
    "json": true,
    "show_payer": false
};
var wallet = "";
var perms = "";
var loggedin = false;
var pools = [];
var target_pool;
var job_id;

String.prototype.format = function () {
    var args = arguments;
    return this.replace(/{([0-9]+)}/g, function (match, index) {
        return typeof args[index] == 'undefined' ? match : args[index];
    });
};

const curEpoch = () => {
    return parseInt(Date.now()/1000);
}

const formatTime = (delta) => {
    const hours = String(Math.floor(delta / 3600)).padStart(2, "0");
    const minutes = String(Math.floor((delta % 3600) / 60)).padStart(2, "0");
    const sec = String(delta % 60).padStart(2, "0");

    return `${hours}:${minutes}:${sec}`;
}

const formatToken = (precision, amount) => {
    return (+(Math.round(+(amount + 'e' + precision)) + 'e' + -precision)).toFixed(precision);
}

const formatTokenLocale = (precision, amount) => {
    return (+(Math.round(+(amount + 'e' + precision)) + 'e' + -precision)).toLocaleString(
        undefined, {
            minimumFractionDigits: precision,
            maximumFractionDigits: precision
        }
    );
}

const fetchBalance = async(contract, symbol) => {
    console.log(symbol);
    var data = await wax.rpc.get_currency_balance(contract, wallet, symbol)
    if (data[0] == undefined) {
        return `0 ${symbol}`;
    } else {
        return data[0];
    }
}

const fetchStaked = async() => {
    for (var pool of pools) {
        STAKES.lower_bound = wallet;
        STAKES.upper_bound = wallet;
        STAKES.scope = pool.pool;

        var data = await wax.rpc.get_table_rows(STAKES);
        if (data.rows.length > 0) {
            pool.open = true;
            pool.staked = data.rows[0].staked;
            let stakedpct = parseFloat(pool.staked.split(" ")[0]) / parseFloat(pool.total_staked.split(" ")[0]) * 100;
            if (isNaN(stakedpct)) {
                pool.stakedpct = "0";
            } else {
                pool.stakedpct = formatToken(2, stakedpct);
            }
            pool.unstake_time = data.rows[0].unstake_time;
            if (curEpoch() >= pool.unstake_time) {
                pool.unstaked = `0 ${pool.symbol}`;
                if (data.rows[0].unstaked.split(" ")[0] == 0) {
                    pool.claim = `0 ${pool.symbol}`;
                } else {
                    pool.claim = data.rows[0].unstaked;
                }
            } else {
                if (data.rows[0].unstaked.split(" ")[0] == 0) {
                    pool.unstaked = `0 ${pool.symbol}`;
                } else {
                    pool.unstaked = data.rows[0].unstaked;
                }
                pool.claim = `0 ${pool.symbol}`;
            }
        } else {
            pool.open = false;
            pool.staked = `0 ${pool.symbol}`;
            pool.unstaked = `0 ${pool.symbol}`;
            pool.claim = `0 ${pool.symbol}`;
            pool.stakedpct = "0";
        }
    }
}

const fetchConfig = async() => {
    pools = [];
    data = await wax.rpc.get_table_rows(CONFIG);
    for (let i = 0; i < data.rows.length; i++) {
        var row = data.rows[i];
        pools.push({
            "pool": row.pool,
            "total_staked": row.total_staked,
            "contract": row.contract,
            "symbol": row.total_staked.split(" ")[1],
            "precision": row.total_staked.split(" ")[0].split(".")[1].length,
            "reduction": row.reduction,
            "reduced": function() {
                return function() {
                    if (this.reduction > 0) {
                        let red = formatToken(3, this.reduction/1000);
                        return `<h6>${red}% daily ðŸ”¥</h6>`;
                    } else {
                        return "";
                    }
                }
            },
            "toclaim": function() {
                return function() {
                    if (this.claim != `0 ${this.symbol}`) {
                        return `<i class="bi bi-exclamation-circle text-warning me-1 align-middle"></i>`;
                    } else {
                        return "";
                    }
                }
            }
        })
    }
}

const setErr = (msg) => {
    $("#err_msg").text(msg);
    $("#err_msg").removeClass("visually-hidden");
}

const setPass = (msg) => {
    $("#pass_msg").html(msg);
    $("#pass_msg").removeClass("visually-hidden");
}

const setModalLoad = (status) => {
    if (status) {
        $("#stake-loading").removeClass("visually-hidden");
        $("#unstake-loading").removeClass("visually-hidden");
        $("#stake-input").addClass("visually-hidden");
        $("#unstake-input").addClass("visually-hidden");
    } else {
        $("#stake-loading").addClass("visually-hidden");
        $("#unstake-loading").addClass("visually-hidden");
        $("#stake-input").removeClass("visually-hidden");
        $("#unstake-input").removeClass("visually-hidden");
    }
}

const setLoad = (status) => {
    if (status) {
        $("#loading").removeClass("visually-hidden");
        $("#content").addClass("visually-hidden");
    } else {
        $("#loading").addClass("visually-hidden");
        $("#content").removeClass("visually-hidden");
    }
}

const logout = async() => {
    await wallet_logout();
    $("#loginbtn").toggleClass("visually-hidden");
    $("#wallet").toggleClass("visually-hidden");
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");
    $("#no_login").removeClass("visually-hidden");
    loggedin = false;

    $("#content").addClass("visually-hidden");
}

const login = async(walletType) => {
    if (walletType) {
        wallet_selectWallet(walletType);
    }

    try {
        $("#login_msg").addClass("visually-hidden");
        wallet = await wallet_login();
        perms = wallet.split("@")[1];
        wallet = wallet.split("@")[0];
        $("#wallet a:first").text(wallet);
        $("#loginbtn").addClass("visually-hidden");
        $("#wallet").removeClass("visually-hidden");
        $("#no_login").addClass("visually-hidden");
        bootstrap.Modal.getOrCreateInstance("#login").hide();
        loggedin = true;

        await refresh();
    } catch(e) {
        $("#login_msg").removeClass("visually-hidden");
        $("#login_msg").text(e.message);
    }
}

const refresh = async() => {
    setLoad(true);

    await fetchConfig();
    await fetchStaked();

    $("#content").empty();
    var template = $("#tmplt_pool").html();
    for (const pool of pools) {
        let rendered = $(Mustache.render(template, pool));
        rendered.appendTo("#content");
        if (pool.open) {
            $("#btn-open-" + pool.pool).prop("disabled", true);
            $("#btn-stake-" + pool.pool).prop("disabled", false);
        } else {
            $("#btn-open-" + pool.pool).prop("disabled", false);
            $("#btn-stake-" + pool.pool).prop("disabled", true);
        }
        $("#btn-close-" + pool.pool).prop("disabled", !(pool.open && parseFloat(pool.staked.split(" ")[0]) == 0 && parseFloat(pool.unstaked.split(" ")[0]) == 0 && parseFloat(pool.claim.split(" ")[0]) == 0));
        $("#btn-unstake-" + pool.pool).prop("disabled", parseFloat(pool.staked.split(" ")[0]) == 0);
        $("#btn-claim-" + pool.pool).prop("disabled", parseFloat(pool.claim.split(" ")[0]) == 0);
    }

    if (job_id != null) {
        clearInterval(job_id);
        job_id = null;
    }
    job_id = setInterval(updateCountdown, 1000);
    setLoad(false);
}

const updateCountdown = () => {
    var filtered = pools.filter(obj => parseFloat(obj.unstaked.split(" ")[0]) > 0);
    for (var pool of filtered) {
        let delta = pool.unstake_time - curEpoch();
        if (delta > 0) {
            $(`#wait-${pool.pool}`).text(formatTime(delta));
        } else {
            pool.claim = pool.unstaked;
            pool.unstaked = `0 ${pool.symbol}`;
            $(`#wait-${pool.pool}`).text("N/A");
            $(`#unstaked-${pool.pool}`).text(pool.unstaked);
            $(`#claim-${pool.pool}`).text(pool.claim);
            $(`#btn-claim-${pool.pool}`).prop("disabled", false);
        }
    };
    if (filtered.length < 1 && job_id != null) {
        clearInterval(job_id);
        job_id = null;
    }
}

const load_stake = async(pool) => {
    setModalLoad(true);
    target_pool = pools.filter(obj => obj.pool == pool);
    let bal = await fetchBalance(target_pool[0].contract, target_pool[0].symbol);
    $("#balance").text(bal);
    $("#stake-amnt").val("");
    setModalLoad(false);
}

const load_unstake = async(pool) => {
    setModalLoad(true);
    target_pool = pools.filter(obj => obj.pool == pool);
    $("#staked").text(target_pool[0].staked);
    $("#unstake-amnt").val("");
    setModalLoad(false);
}

const fill_max = (target) => {
    if (target == "balance") {
        $("#stake-amnt").val($("#balance").text().split(" ")[0]);
    } else {
        $("#unstake-amnt").val($("#staked").text().split(" ")[0]);
    }
}

const open_bal = async(pool) => {
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");

    if (!loggedin) {
        setErr("Please login first");
        return;
    }

    try {
        var actions = [{
            account: CONTRACT,
            name: "open",
            authorization: [{
                actor: wallet,
                permission: perms,
            }],
            data: {
                pool: pool,
                wallet: wallet
            }
        }];
        var txn = await wallet_transact(actions);
        setPass("Success! <a href='{0}{1}' target='_blank'>View Transaction</a>".format(EXPLORER, txn.transaction_id));
        setTimeout(async() => {
            await refresh();
        }, 1500);
    } catch(e) {
        setErr(e.message);
    }
}

const close_bal = async(pool) => {
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");

    if (!loggedin) {
        setErr("Please login first");
        return;
    }

    try {
        var actions = [{
            account: CONTRACT,
            name: "close",
            authorization: [{
                actor: wallet,
                permission: perms,
            }],
            data: {
                pool: pool,
                wallet: wallet
            }
        }];
        var txn = await wallet_transact(actions);
        setPass("Success! <a href='{0}{1}' target='_blank'>View Transaction</a>".format(EXPLORER, txn.transaction_id));
        setTimeout(async() => {
            await refresh();
        }, 1500);
    } catch(e) {
        setErr(e.message);
    }
}

const claim = async(pool) => {
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");

    if (!loggedin) {
        setErr("Please login first");
        return;
    }

    try {
        var actions = [{
            account: CONTRACT,
            name: "claim",
            authorization: [{
                actor: wallet,
                permission: perms,
            }],
            data: {
                pool: pool,
                wallet: wallet
            }
        }];
        var txn = await wallet_transact(actions);
        setPass("Success! <a href='{0}{1}' target='_blank'>View Transaction</a>".format(EXPLORER, txn.transaction_id));
        setTimeout(async() => {
            await refresh();
        }, 1500);
    } catch(e) {
        setErr(e.message);
    }
}

const stake = async() => {
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");

    if (!loggedin) {
        setErr("Please login first");
        return;
    }

    try {
        var actions = [{
            account: target_pool[0].contract,
            name: "transfer",
            authorization: [{
                actor: wallet,
                permission: perms,
            }],
            data: {
                from: wallet,
                to: CONTRACT,
                quantity: `${formatToken(target_pool[0].precision, ($("#stake-amnt").val()))} ${target_pool[0].symbol}`,
                memo: `stake;${target_pool[0].pool}`
            }
        }];
        var txn = await wallet_transact(actions);
        bootstrap.Modal.getOrCreateInstance("#stake").hide();
        setPass("Success! <a href='{0}{1}' target='_blank'>View Transaction</a>".format(EXPLORER, txn.transaction_id));
        setTimeout(async() => {
            await refresh();
        }, 1500);
    } catch(e) {
        bootstrap.Modal.getOrCreateInstance("#stake").hide();
        setErr(e.message);
    }
}

const unstake = async() => {
    $("#err_msg").addClass("visually-hidden");
    $("#pass_msg").addClass("visually-hidden");

    if (!loggedin) {
        setErr("Please login first");
        return;
    }

    try {
        var actions = [{
            account: CONTRACT,
            name: "unstake",
            authorization: [{
                actor: wallet,
                permission: perms,
            }],
            data: {
                wallet: wallet,
                pool: target_pool[0].pool,
                amnt: `${formatToken(target_pool[0].precision, ($("#unstake-amnt").val()))} ${target_pool[0].symbol}`,
            }
        }];
        var txn = await wallet_transact(actions);
        bootstrap.Modal.getOrCreateInstance("#unstake").hide();
        setPass("Success! <a href='{0}{1}' target='_blank'>View Transaction</a>".format(EXPLORER, txn.transaction_id));
        setTimeout(async() => {
            await refresh();
        }, 1500);
    } catch(e) {
        bootstrap.Modal.getOrCreateInstance("#unstake").hide();
        setErr(e.message);
    }
}

$(document).ready(async function() {
    if (await wallet_isAutoLoginAvailable()) {
        await login();
    }
});
</script>
</body>
</html>